# Rext Demo Project

This is a simple demo project that showcases all the features Rext *will* incorporate. This project was *not* created by Rext, but it is a good example of what Rext *will* be able to do.

## Getting Started

- In `example_rext_project` run `cargo run`.
- In `example_rext_project/frontend` run `npm i && npm run dev`

This spins up a Rust server listening on port 3000 and a Vite server running on port 5173.

The Rust server has a CORS bypass that allows these two ports to communicate via HTTP on `localhost`. In a real Rext app, we'll use `letsencrypt` self-signed certificates and domains on local host so we can use HTTPS and avoid CORS issues.

## Features

- **Frontend** - Written in Vue with Vue Router
- **Database** - a sqlite database for getting up and running quickly. Support for MySQL, Postgresql, and sqlite will be goals.
- **ORM** - an object relational model for accessing the database via [sea-orm](https://www.sea-ql.org/SeaORM/)
- **Web Server** - powered by [axum](https://crates.io/crates/axum)
- **Routing** - powered by the web server
- **Authentication** - simple yet secure authentication with [argon2](https://crates.io/crates/argon2) and [jsonwebtoken](https://crates.io/crates/jsonwebtoken).
- **SPA Navigation** - reactive authentication state with seamless single-page app experience
- **OpenAPI Generation** - Generates an OpenAPI document and serves SwaggerUI, Redoc, and Scalar pages
- **Middleware** - A simple middleware implementation for authentication
- **API Client** - A Type-safe API client generated by Hey API for types and API requests
- **Task Scheduler** - A task scheduler built on top of apalis
- **Job Queue** - A job queue built on top of apalis
- **Layered Architecture** - A clean separation of concerns between frontend and backend, with clear boundaries between each layer.

## How to use

- Navigate to `http://localhost:5173/` in your browser to view the Demo Vue app.
- Visit `/register` to create an account.
    - Email needs to be in email format, but it doesn't need to be real. Password is hashed with `argon2` on the backend.
    - If you get network errors, be sure you're on `localhost`, not `127.0.0.1`, same thing in concept but the CORS bypass is only set up for `localhost`.
- After registering, you can login at `/login`.
    - This passes you a token that is stored in your browser.
- This should route you to `/profile`.
    - This is a protected route, you can only access it when logged in. Should redirect to `/login` if logged out.
- Logout using the "Logout" button in the navigation bar, which removes the token from your browser and updates the UI in real-time.
- Visit the API docs at localhost:3000/scalar

### Admin Access

**Default Admin User:**
- **Email**: `admin@localhost.com`
- **Password**: `admin`
- **Note**: This user is automatically created when the application starts for the first time.

**Admin API Endpoints:**
- Admin login: `POST /api/v1/admin/login`
- View API documentation: `http://localhost:3000/scalar` (look for "Admin" tag)
- **Important**: Change the default admin password immediately after first login!

**Admin Panel Access:**
- **Frontend URL**: `http://localhost:5173/admin/login`
- **Default Credentials**: `admin@localhost.com` / `admin`
- **Features**: User management, request logs, database browser, system health
- **Documentation**: See `ADMIN_PANEL.md` for detailed usage instructions

## Next Steps
*A quick outline of the upcoming goals for this project*
- Establish sub-domains for local dev
    - This will be tested in this project, but it cannot be automated 100% by Rext. We can generate templates and self-signed certs, then provide a guide for the remaining steps. That's it.
- prepare deployment process
- Asset optimization - mostly build step, rust just needs to serve the proper headers and files
- Email Server - https://crates.io/crates/lettre
- Admin panel
- Tracing
- logging

## ğŸ› ï¸ Admin Panel Implementation Plan

### Overview
This project will implement a custom admin panel with request logging, user management, and database inspection capabilities. The implementation follows the existing architecture patterns and provides a Django admin-like experience.

### Implementation Phases

#### Phase 1: Request Logging Infrastructure âœ… (Done)
- [x] Add request logging middleware
- [x] Create audit_logs database table
- [x] Add admin user roles to users table
- [x] Create admin authentication middleware

#### Phase 2: Admin API Endpoints âœ… (Done)
- [x] Admin authentication endpoints (login/logout)
- [x] Request history endpoints (paginated, filtered)
- [x] User management endpoints (list, view, edit, delete)
- [x] Database table inspection endpoints
- [x] System health endpoints

#### Phase 3: Admin Frontend âœ… (Done)
- [x] Admin layout and navigation
- [x] Request history dashboard with filtering/search
- [x] User management interface
- [x] Database table browser
- [x] System health dashboard

#### Break Time!

There are some issues with the admin panel:
- AG Grid reporting theme and CSS errors, all in all it doesn't work very well.
- Database view is just reporting NULL as all the record vales
- Request Logs count on the main admin panel page is "5".... there are 170+.
- Clicking a request to view the details in a modal doesn't pretty print the body.
- We have request AND response bodies? Why only show one?
- Lots of terrible color choices being made
- system health has uptime and database set to unknown... makes sense I guess? We don't report on these metrics nor do I know the best way to get them.

#### Phase 4: Advanced Features
- [ ] Real-time request monitoring (what does this mean?)
- [ ] Performance metrics and analytics (what's the difference between this and seeing request ms time?)
- [ ] Export functionality (CSV, JSON)
- [ ] Admin user management (we already do this? What's this mean?)
- [ ] Role-based permissions (yes, important. Will need a 'roles' table or a 'role' field on the user)

### Current Status: Phase 3 - Admin Frontend âœ… (Complete)

**Completed:**
- âœ… Request logging middleware and audit_logs table
- âœ… Admin user roles added to users table
- âœ… Admin authentication endpoints (login/logout)
- âœ… Request history endpoints (paginated, filtered)
- âœ… User management endpoints (list, view, edit, delete)
- âœ… Database table inspection endpoints
- âœ… System health endpoints
- âœ… **Admin user seeding during application startup**
- âœ… **Complete Admin Frontend with AG Grid integration**
- âœ… **Admin layout and navigation system**
- âœ… **Request history dashboard with advanced filtering**
- âœ… **User management interface with CRUD operations**
- âœ… **Database table browser with record inspection**
- âœ… **System health dashboard with real-time metrics**

**Admin User Seeding:**
The application now automatically creates an admin user during startup with the following features:
- **Idempotent Creation**: Only creates admin if it doesn't exist
- **Environment Configuration**: Configurable via environment variables
- **Secure Defaults**: Uses `admin@localhost` / `admin` as default credentials
- **Audit Logging**: Logs admin creation for security monitoring

**Environment Variables for Admin:**
```env
CREATE_ADMIN_USER=true          # Enable/disable admin creation
ADMIN_EMAIL=admin@localhost     # Admin email address
ADMIN_PASSWORD=admin           # Admin password (change in production!)
```

## Architecture

This project takes a layered approach to architecture with clear separation of concerns between frontend, backend, and database layers.

### Project Structure

```
example_rext_project/
â”œâ”€â”€ backend/                   # Rust backend application
â”‚   â”œâ”€â”€ main.rs                # Application entry point and server setup
â”‚   â”œâ”€â”€ bridge/                # Web API layer (HTTP handlers, routes, middleware)
â”‚   â”‚   â”œâ”€â”€ mod.rs
â”‚   â”‚   â”œâ”€â”€ handlers/          # HTTP request handlers
â”‚   â”‚   â”‚   â”œâ”€â”€ mod.rs
â”‚   â”‚   â”‚   â””â”€â”€ auth.rs        # Authentication handlers
â”‚   â”‚   â”œâ”€â”€ routes/            # API route definitions
â”‚   â”‚   â”‚   â”œâ”€â”€ mod.rs
â”‚   â”‚   â”‚   â””â”€â”€ auth.rs        # Authentication routes
â”‚   â”‚   â”œâ”€â”€ middleware/        # HTTP middleware
â”‚   â”‚   â”‚   â”œâ”€â”€ mod.rs
â”‚   â”‚   â”‚   â””â”€â”€ auth.rs        # Authentication middleware
â”‚   â”‚   â””â”€â”€ types/             # API-specific types
â”‚   â”‚       â”œâ”€â”€ mod.rs
â”‚   â”‚       â””â”€â”€ auth.rs        # Authentication types
â”‚   â”œâ”€â”€ control/               # Business logic layer
â”‚   â”‚   â””â”€â”€ services/          # Service implementations
â”‚   â”œâ”€â”€ domain/                # Domain models and business rules
â”‚   â”œâ”€â”€ entity/                # Database entity layer (Sea-ORM)
â”‚   â”‚   â”œâ”€â”€ mod.rs
â”‚   â”‚   â””â”€â”€ models/            # Database entity models
â”‚   â”‚       â”œâ”€â”€ mod.rs
â”‚   â”‚       â”œâ”€â”€ prelude.rs     # Common entity imports
â”‚   â”‚       â””â”€â”€ users.rs       # User entity model
â”‚   â””â”€â”€ infrastructure/        # Infrastructure concerns
â”‚       â”œâ”€â”€ mod.rs
â”‚       â”œâ”€â”€ app_error.rs       # Application error types
â”‚       â””â”€â”€ jwt_claims.rs      # JWT token claims
â”œâ”€â”€ frontend/                  # Vue.js frontend application
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ main.ts            # Frontend entry point
â”‚   â”‚   â”œâ”€â”€ App.vue            # Root Vue component
â”‚   â”‚   â”œâ”€â”€ appearance/        # Presentation layer
â”‚   â”‚   â”‚   â”œâ”€â”€ components/    # Reusable Vue components
â”‚   â”‚   â”‚   â””â”€â”€ views/         # Page views
â”‚   â”‚   â”‚       â”œâ”€â”€ HomeView.vue      # Landing page
â”‚   â”‚   â”‚       â”œâ”€â”€ LoginView.vue     # User login form
â”‚   â”‚   â”‚       â”œâ”€â”€ RegisterView.vue  # User registration form
â”‚   â”‚   â”‚       â””â”€â”€ ProfileView.vue   # User profile page
â”‚   â”‚   â””â”€â”€ bridge/            # API client layer
â”‚   â”‚       â”œâ”€â”€ client/        # Generated API client
â”‚   â”‚       â”‚   â”œâ”€â”€ client/    # Core client implementation
â”‚   â”‚       â”‚   â”œâ”€â”€ core/      # Client utilities and types
â”‚   â”‚       â”‚   â”œâ”€â”€ client.gen.ts     # Generated client code
â”‚   â”‚       â”‚   â”œâ”€â”€ sdk.gen.ts # Generated SDK
â”‚   â”‚       â”‚   â””â”€â”€ types.gen.ts      # Generated types
â”‚   â”‚       â””â”€â”€ router/        # Vue Router configuration
â”‚   â”œâ”€â”€ e2e/                   # End-to-end tests (Playwright)
â”‚   â”‚   â”œâ”€â”€ tsconfig.json      # E2E TypeScript config
â”‚   â”‚   â””â”€â”€ vue.spec.ts        # E2E test specifications
â”‚   â”œâ”€â”€ config/                # Build and tooling configuration
â”‚   â”‚   â””â”€â”€ unified.config.ts  # Unified configuration
â”‚   â”œâ”€â”€ package.json           # Frontend dependencies
â”‚   â”œâ”€â”€ vite.config.ts         # Vite build configuration
â”‚   â”œâ”€â”€ tsconfig.json          # TypeScript configuration
â”‚   â””â”€â”€ eslint.config.ts       # ESLint configuration
â”œâ”€â”€ migration/                 # Database migration system (Sea-ORM)
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ lib.rs             # Migration registry and setup
â”‚   â”‚   â”œâ”€â”€ main.rs            # Migration runner
â”‚   â”‚   â””â”€â”€ m20250720_000001_create_users.rs  # Users table migration
â”‚   â”œâ”€â”€ Cargo.toml             # Migration dependencies
â”‚   â””â”€â”€ README.md              # Migration documentation
â”œâ”€â”€ Cargo.toml                 # Rust workspace configuration
â”œâ”€â”€ rext.toml                  # Rext framework configuration
â”œâ”€â”€ example.env                # Environment variables template
â””â”€â”€ README.md                  # Project documentation
```

### Architecture Layers

#### Backend (Rust)
- **Bridge Layer**: HTTP API endpoints, middleware, and request/response handling
- **Control Layer**: Business logic and service orchestration
- **Domain Layer**: Core business models and rules
- **Entity Layer**: Database models and ORM integration (Sea-ORM)
- **Infrastructure Layer**: Cross-cutting concerns (errors, JWT, etc.)

#### Frontend (Vue.js)
- **Appearance Layer**: UI components and page views
- **Bridge Layer**: API client and routing
- **Client Layer**: Generated type-safe API client

#### Database
- **Migration System**: Version-controlled database schema changes
- **Entity Models**: Type-safe database access with Sea-ORM

### Key Design Principles

1. **Separation of Concerns**: Clear boundaries between presentation, business logic, and data layers
2. **Type Safety**: Full TypeScript on frontend, strong typing in Rust backend
3. **API-First**: OpenAPI specification with generated clients
4. **Layered Architecture**: Clean separation between HTTP, business logic, and data access
5. **Generated Code**: Type-safe API clients and database entities generated from specifications