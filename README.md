# Rext Demo Project

This is a simple demo project that showcases all the features Rext *will* incorporate. This project was *not* created by Rext, but it is a good example of what Rext *will* be able to do.

## Getting Started

- In `example_rext_project` run `cargo run`.
- In `example_rext_project/frontend` run `npm i && npm run dev`

This spins up a Rust server listening on port 3000 and a Vite server running on port 5173.

The Rust server has a CORS bypass that allows these two ports to communicate via HTTP on `localhost`. In a real Rext app, we'll use self-signed certificates and domains on local host so we can use HTTPS and avoid CORS issues.

## Features

- **Frontend** - Written in Vue with Vue Router
- **Database** - a sqlite database for getting up and running quickly. Support for MySQL, Postgresql, and sqlite will be goals.
- **ORM** - an object relational model for accessing the database via [sea-orm](https://www.sea-ql.org/SeaORM/)
- **Web Server** - powered by [axum](https://crates.io/crates/axum)
- **Routing** - powered by the web server
- **Authentication** - simple yet secure authentication with [argon2](https://crates.io/crates/argon2) and [jsonwebtoken](https://crates.io/crates/jsonwebtoken).
- **SPA Navigation** - reactive authentication state with seamless single-page app experience
- **OpenAPI Generation** - Generates an OpenAPI document and serves SwaggerUI, Redoc, and Scalar pages
- **Middleware** - A simple middleware implementation for authentication
- **API Client** - A Type-safe API client generated by Hey API for types and API requests
- **Task Scheduler** - A task scheduler built on top of apalis
- **Job Queue** - A job queue built on top of apalis
- **Layered Architecture** - A clean separation of concerns between frontend and backend, with clear boundaries between each layer.
- **Admin Panel** - A dashboard where you can view request logs, manage users, manager user sessions, manage user roles, view database tables and records, monitor system health, and view requests and logs in real time view a real time web socket connection.
- **Logging** - Middleware logs all HTTP requests in an audit table.
- **Users and Roles** - Manage users and their permissions via a simple and extensible roles system.
- **System Metrics** - View system health, uptime, performance, errors, activity, and system resources.
- **User Sessions** - View all active user sessions and invalidate sessions remotely.

## How to use

- Navigate to `http://localhost:5173/` in your browser to view the Demo Vue app.
- Visit `/register` to create an account.
  - Email needs to be in email format, but it doesn't need to be real. Password is hashed with `argon2` on the backend.
  - If you get network errors, be sure you're on `localhost`, not `127.0.0.1`, same thing in concept but the CORS bypass is only set up for `localhost`.
- After registering, you can login at `/login`.
  - This passes you a token that is stored in your browser.
- This should route you to `/profile`.
  - This is a protected route, you can only access it when logged in. Should redirect to `/login` if logged out.
- Logout using the "Logout" button in the navigation bar, which removes the token from your browser and updates the UI in real-time.
- Visit the API docs at localhost:3000/scalar
- Login to the admin panel at `/admin/login`.
  - From here you can manage users, view logs, view database records, and view system health metrics.

### Admin Access

**Default Admin User:**
- **Email**: `admin@localhost.com`
- **Password**: `admin123`
- **Note**: This user is automatically created when the application starts for the first time.

**Admin API Endpoints:**
- Admin login: `POST /api/v1/admin/login`
- View API documentation: `http://localhost:3000/scalar` (look for "Admin" tag)

**Admin Panel Access:**
- **Frontend URL**: `http://localhost:5173/admin/login`

## ğŸš€ Deployment

The project includes comprehensive deployment options for both development and production environments.

### Quick Deployment Options

#### Docker (Recommended)
```bash
# Quick production deployment
cp example.env .env  # Configure your environment
docker-compose up -d
```

#### Bare Metal
```bash
# Automated setup and build
./scripts/dev-setup.sh      # Development setup
./scripts/build-production.sh # Production build
```

### Deployment Methods

- **ğŸ³ Docker Deployment**: Single container with multi-stage build
- **ğŸ–¥ï¸ Bare Metal Deployment**: Native binary with frontend assets
- **ğŸ“¦ Build Automation**: Automated frontend building via `build.rs`
- **ğŸ› ï¸ Development Scripts**: Convenient setup and development workflows

See **[DEPLOYMENT.md](./DEPLOYMENT.md)** for comprehensive deployment instructions.

### Production Features

- âœ… Multi-stage Docker build optimized for production
- âœ… Automated frontend asset building and bundling
- âœ… Single binary deployment with embedded static serving
- âœ… Environment-based configuration
- âœ… Database migrations included
- âœ… Health checks and monitoring ready
- âœ… Security-hardened defaults

## Next Steps
*A quick outline of the upcoming goals for this project*
- âœ… ~~prepare deployment process~~ **COMPLETED**
  - âœ… Docker compose file with multi-stage build
  - âœ… Build.rs script for automated frontend building
  - âœ… Bare metal deployment scripts and documentation
- Email Server 
  - https://crates.io/crates/lettre
  - This crate provides email building, transport systems (SMTP), security features, Unicode and internationalization support.
  - Due to how emailing works, this will not be an SMTP server, just forward emails to one, then the SMTP server provider (i.e. Google) can take care of the heavy lifting.

## Architecture

This project takes a layered approach to architecture with clear separation of concerns between frontend, backend, and database layers.

### Project Structure

```
example_rext_project/
â”œâ”€â”€ backend/                   # Rust backend application
â”‚   â”œâ”€â”€ main.rs                # Application entry point and server setup
â”‚   â”œâ”€â”€ bridge/                # Web API layer (HTTP handlers, routes, middleware)
â”‚   â”‚   â”œâ”€â”€ mod.rs
â”‚   â”‚   â”œâ”€â”€ handlers/          # HTTP request handlers
â”‚   â”‚   â”‚   â”œâ”€â”€ mod.rs
â”‚   â”‚   â”‚   â””â”€â”€ auth.rs        # Authentication handlers
â”‚   â”‚   â”œâ”€â”€ routes/            # API route definitions
â”‚   â”‚   â”‚   â”œâ”€â”€ mod.rs
â”‚   â”‚   â”‚   â””â”€â”€ auth.rs        # Authentication routes
â”‚   â”‚   â”œâ”€â”€ middleware/        # HTTP middleware
â”‚   â”‚   â”‚   â”œâ”€â”€ mod.rs
â”‚   â”‚   â”‚   â””â”€â”€ auth.rs        # Authentication middleware
â”‚   â”‚   â””â”€â”€ types/             # API-specific types
â”‚   â”‚       â”œâ”€â”€ mod.rs
â”‚   â”‚       â””â”€â”€ auth.rs        # Authentication types
â”‚   â”œâ”€â”€ control/               # Business logic layer
â”‚   â”‚   â””â”€â”€ services/          # Service implementations
â”‚   â”œâ”€â”€ domain/                # Domain models and business rules
â”‚   â”œâ”€â”€ entity/                # Database entity layer (Sea-ORM)
â”‚   â”‚   â”œâ”€â”€ mod.rs
â”‚   â”‚   â””â”€â”€ models/            # Database entity models
â”‚   â”‚       â”œâ”€â”€ mod.rs
â”‚   â”‚       â”œâ”€â”€ prelude.rs     # Common entity imports
â”‚   â”‚       â””â”€â”€ users.rs       # User entity model
â”‚   â””â”€â”€ infrastructure/        # Infrastructure concerns
â”‚       â”œâ”€â”€ mod.rs
â”‚       â”œâ”€â”€ app_error.rs       # Application error types
â”‚       â””â”€â”€ jwt_claims.rs      # JWT token claims
â”œâ”€â”€ frontend/                  # Vue.js frontend application
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ main.ts            # Frontend entry point
â”‚   â”‚   â”œâ”€â”€ App.vue            # Root Vue component
â”‚   â”‚   â”œâ”€â”€ appearance/        # Presentation layer
â”‚   â”‚   â”‚   â”œâ”€â”€ components/    # Reusable Vue components
â”‚   â”‚   â”‚   â””â”€â”€ views/         # Page views
â”‚   â”‚   â”‚       â”œâ”€â”€ HomeView.vue      # Landing page
â”‚   â”‚   â”‚       â”œâ”€â”€ LoginView.vue     # User login form
â”‚   â”‚   â”‚       â”œâ”€â”€ RegisterView.vue  # User registration form
â”‚   â”‚   â”‚       â””â”€â”€ ProfileView.vue   # User profile page
â”‚   â”‚   â””â”€â”€ bridge/            # API client layer
â”‚   â”‚       â”œâ”€â”€ client/        # Generated API client
â”‚   â”‚       â”‚   â”œâ”€â”€ client/    # Core client implementation
â”‚   â”‚       â”‚   â”œâ”€â”€ core/      # Client utilities and types
â”‚   â”‚       â”‚   â”œâ”€â”€ client.gen.ts     # Generated client code
â”‚   â”‚       â”‚   â”œâ”€â”€ sdk.gen.ts # Generated SDK
â”‚   â”‚       â”‚   â””â”€â”€ types.gen.ts      # Generated types
â”‚   â”‚       â””â”€â”€ router/        # Vue Router configuration
â”‚   â”œâ”€â”€ e2e/                   # End-to-end tests (Playwright)
â”‚   â”‚   â”œâ”€â”€ tsconfig.json      # E2E TypeScript config
â”‚   â”‚   â””â”€â”€ vue.spec.ts        # E2E test specifications
â”‚   â”œâ”€â”€ config/                # Build and tooling configuration
â”‚   â”‚   â””â”€â”€ unified.config.ts  # Unified configuration
â”‚   â”œâ”€â”€ package.json           # Frontend dependencies
â”‚   â”œâ”€â”€ vite.config.ts         # Vite build configuration
â”‚   â”œâ”€â”€ tsconfig.json          # TypeScript configuration
â”‚   â””â”€â”€ eslint.config.ts       # ESLint configuration
â”œâ”€â”€ migration/                 # Database migration system (Sea-ORM)
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ lib.rs             # Migration registry and setup
â”‚   â”‚   â”œâ”€â”€ main.rs            # Migration runner
â”‚   â”‚   â””â”€â”€ m20250720_000001_create_users.rs  # Users table migration
â”‚   â”œâ”€â”€ Cargo.toml             # Migration dependencies
â”‚   â””â”€â”€ README.md              # Migration documentation
â”œâ”€â”€ Cargo.toml                 # Rust workspace configuration
â”œâ”€â”€ rext.toml                  # Rext framework configuration
â”œâ”€â”€ example.env                # Environment variables template
â””â”€â”€ README.md                  # Project documentation
```

### Architecture Layers

#### Backend (Rust)
- **Bridge Layer**: HTTP API endpoints, middleware, and request/response handling
- **Control Layer**: Business logic and service orchestration
- **Domain Layer**: Core business models and rules
- **Entity Layer**: Database models and ORM integration (Sea-ORM)
- **Infrastructure Layer**: Cross-cutting concerns (errors, JWT, etc.)

#### Frontend (Vue.js)
- **Appearance Layer**: UI components and page views
- **Bridge Layer**: API client and routing
- **Client Layer**: Generated type-safe API client

#### Database
- **Migration System**: Version-controlled database schema changes
- **Entity Models**: Type-safe database access with Sea-ORM

### Key Design Principles

1. **Separation of Concerns**: Clear boundaries between presentation, business logic, and data layers
2. **Type Safety**: Full TypeScript on frontend, strong typing in Rust backend
3. **API-First**: OpenAPI specification with generated clients
4. **Layered Architecture**: Clean separation between HTTP, business logic, and data access
5. **Generated Code**: Type-safe API clients and database entities generated from specifications